
// Import without ES modules for browser compatibility
// import { SUPABASE_URL, SUPABASE_ANON_KEY } from './config.js';

console.log("Bob Empire initialized");

// For now, use placeholder values until proper configuration is set
const SUPABASE_URL = "https://your-project-ref.supabase.co";
const SUPABASE_ANON_KEY = "your-anon-key";

console.log("Supabase URL:", SUPABASE_URL);

// Global state
let currentUser = null;
let isLoggedIn = false;

// Authentication functions
function login() {
  const email = document.getElementById('email')?.value;
  const password = document.getElementById('password')?.value;
  
  if (email && password) {
    // Mock login for now - will be replaced with actual Supabase auth
    currentUser = { email };
    isLoggedIn = true;
    showDashboard();
    showMessage("โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ!", "success");
  } else {
    showMessage("โ ูุฑุฌู ุฅุฏุฎุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ", "error");
  }
}

function signup() {
  const email = document.getElementById('email')?.value;
  const password = document.getElementById('password')?.value;
  const confirmPassword = document.getElementById('confirmPassword')?.value;
  
  if (!email || !password || !confirmPassword) {
    showMessage("โ ูุฑุฌู ููุก ุฌููุน ุงูุญููู", "error");
    return;
  }
  
  if (password !== confirmPassword) {
    showMessage("โ ูููุงุช ุงููุฑูุฑ ุบูุฑ ูุชุทุงุจูุฉ", "error");
    return;
  }
  
  // Mock signup for now - will be replaced with actual Supabase auth
  currentUser = { email };
  isLoggedIn = true;
  showDashboard();
  showMessage("โ ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ!", "success");
}

function logout() {
  currentUser = null;
  isLoggedIn = false;
  showLoginForm();
  showMessage("โ ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ", "success");
}

function showMessage(message, type = "info") {
  const messageDiv = document.getElementById('message') || createMessageDiv();
  messageDiv.textContent = message;
  messageDiv.className = `message ${type}`;
  messageDiv.style.display = 'block';
  setTimeout(() => {
    messageDiv.style.display = 'none';
  }, 5000);
}

function createMessageDiv() {
  const messageDiv = document.createElement('div');
  messageDiv.id = 'message';
  messageDiv.className = 'message';
  document.body.appendChild(messageDiv);
  return messageDiv;
}

function showLoginForm() {
  document.body.innerHTML = `
    <div class="hero">
      <img src="logo_bob_empire.png" alt="Bob Empire" class="logo" onerror="this.style.display='none'">
      <h1>๐ Bob Empire</h1>
      <p class="tag">ููุตุฉ ุชุฌุงุฑุฉ ุนุงูููุฉ ูููุฏูุง ุงูุฐูุงุก ุงูุงุตุทูุงุนู</p>
    </div>
    
    <div id="message" class="message" style="display: none;"></div>
    
    <main class="main">
      <div class="card">
        <h2>ุชุณุฌูู ุงูุฏุฎูู / ุฅูุดุงุก ุญุณุงุจ</h2>
        <div class="form-group">
          <input type="email" id="email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" required>
        </div>
        <div class="form-group">
          <input type="password" id="password" placeholder="ูููุฉ ุงููุฑูุฑ" required>
        </div>
        <div class="form-group" id="confirmPasswordGroup" style="display: none;">
          <input type="password" id="confirmPassword" placeholder="ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ">
        </div>
        <div class="form-actions">
          <button onclick="login()" id="loginBtn">ุชุณุฌูู ุงูุฏุฎูู</button>
          <button onclick="showSignupForm()" id="signupToggle">ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</button>
        </div>
      </div>
    </main>
  `;
}

function showSignupForm() {
  document.getElementById('confirmPasswordGroup').style.display = 'block';
  document.getElementById('loginBtn').textContent = 'ุฅูุดุงุก ุงูุญุณุงุจ';
  document.getElementById('loginBtn').onclick = signup;
  document.getElementById('signupToggle').textContent = 'ูุฏูู ุญุณุงุจุ ุณุฌู ุงูุฏุฎูู';
  document.getElementById('signupToggle').onclick = showLoginForm;
}

function showDashboard() {
  document.body.innerHTML = `
    <div class="hero">
      <img src="logo_bob_empire.png" alt="Bob Empire" class="logo" onerror="this.style.display='none'">
      <h1>๐ Bob Empire</h1>
      <p class="tag">ูุฑุญุจุงู ${currentUser?.email || 'ุงููุณุชุฎุฏู'}</p>
      <button onclick="logout()" class="logout-btn">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
    </div>
    
    <div id="message" class="message" style="display: none;"></div>
    
    <div class="tabs">
      <button onclick="showTab('dashboard')" class="tab-btn active">ููุญุฉ ุงูุชุญูู</button>
      <button onclick="showTab('chat')" class="tab-btn">ุงููุญุงุฏุซุฉ ุงูุฐููุฉ</button>
      <button onclick="showTab('agents')" class="tab-btn">ุงููููุงุก</button>
      <button onclick="showTab('flows')" class="tab-btn">ุงูุชุฏููุงุช</button>
      <button onclick="showTab('platforms')" class="tab-btn">ุงูููุตุงุช ุงูุนุงูููุฉ</button>
      <button onclick="showTab('admin')" class="tab-btn">ุงูุฅุฏุงุฑุฉ</button>
    </div>
    
    <main class="main">
      <div id="dashboard" class="tab active">
        <div class="grid">
          <div class="card">
            <h3>๐ ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ</h3>
            <p>ุงูุทูุจุงุช: <strong>12</strong></p>
            <p>ุงูุฅูุฑุงุฏุงุช: <strong>$3,500</strong></p>
            <p>ุงููููุงุก ุงููุดุทูู: <strong>140</strong></p>
            <p>ุญุงูุฉ ุงูุชุณุงุฑุน: <strong id="turboStatus">ูุชููู</strong></p>
          </div>
          <div class="card">
            <h3>๐ ุฃูุงูุฑ ุณุฑูุนุฉ</h3>
            <button onclick="executeCommand('/turbo on')" class="btn">ุชูุนูู ุงูุชุณุงุฑุน</button>
            <button onclick="executeCommand('/connect all')" class="btn">ุฑุจุท ุฌููุน ุงูููุตุงุช</button>
            <button onclick="executeCommand('/run 1 ูุฑุญุจุง')" class="btn">ุชุดุบูู ุงููููู #1</button>
          </div>
        </div>
      </div>
      
      <div id="chat" class="tab">
        <div class="card">
          <h3>๐ฌ ุงููุญุงุฏุซุฉ ุงูุฐููุฉ</h3>
          <div id="chatMessages" class="chat-messages"></div>
          <div class="chat-input">
            <input type="text" id="chatInput" placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..." onkeypress="if(event.key=='Enter') sendMessage()">
            <button onclick="sendMessage()" class="btn">ุฅุฑุณุงู</button>
            <button onclick="startVoiceInput()" class="btn">๐ค</button>
          </div>
        </div>
      </div>
      
      <div id="agents" class="tab">
        <div class="card">
          <h3>๐ค ุฅุฏุงุฑุฉ ุงููููุงุก</h3>
          <button onclick="loadAgents()" class="btn">ุชุญุฏูุซ ุงููุงุฆูุฉ</button>
          <button onclick="addNewAgent()" class="btn">ุฅุถุงูุฉ ูููู ุฌุฏูุฏ</button>
          <div id="agentsList" class="agents-list"></div>
        </div>
      </div>
      
      <div id="flows" class="tab">
        <div class="card">
          <h3>โก ุฅุฏุงุฑุฉ ุงูุชุฏููุงุช</h3>
          <button onclick="loadFlows()" class="btn">ุชุญุฏูุซ ุงููุงุฆูุฉ</button>
          <button onclick="addNewFlow()" class="btn">ุฅุถุงูุฉ ุชุฏูู ุฌุฏูุฏ</button>
          <div id="flowsList" class="flows-list"></div>
        </div>
      </div>
      
      <div id="platforms" class="tab">
        <div class="card">
          <h3>๐ ุงูููุตุงุช ุงูุนุงูููุฉ</h3>
          <div class="grid">
            <div class="platform-card">
              <h4>๐ ููุตุงุช ุงูุชุฌุงุฑุฉ</h4>
              <button onclick="connectPlatform('amazon')" class="btn">Amazon</button>
              <button onclick="connectPlatform('shopify')" class="btn">Shopify</button>
              <button onclick="connectPlatform('aliexpress')" class="btn">AliExpress</button>
              <button onclick="connectPlatform('alibaba')" class="btn">Alibaba</button>
            </div>
            <div class="platform-card">
              <h4>๐ฐ ููุตุงุช ุงูุฏูุน</h4>
              <button onclick="connectPlatform('stripe')" class="btn">Stripe</button>
              <button onclick="connectPlatform('paypal')" class="btn">PayPal</button>
              <button onclick="connectPlatform('fawry')" class="btn">Fawry</button>
            </div>
            <div class="platform-card">
              <h4>๐ฑ ููุตุงุช ุงูุชูุงุตู</h4>
              <button onclick="connectPlatform('whatsapp')" class="btn">WhatsApp</button>
              <button onclick="connectPlatform('telegram')" class="btn">Telegram</button>
              <button onclick="connectPlatform('instagram')" class="btn">Instagram</button>
            </div>
          </div>
        </div>
      </div>
      
      <div id="admin" class="tab">
        <div class="card">
          <h3>โ๏ธ ููุญุฉ ุงูุฅุฏุงุฑุฉ</h3>
          <div class="admin-section">
            <h4>ุฅุนุฏุงุฏุงุช ุงููุธุงู</h4>
            <button onclick="toggleTurbo()" class="btn">ุชุจุฏูู ุงูุชุณุงุฑุน</button>
            <button onclick="syncIntegrations()" class="btn">ูุฒุงููุฉ ุงูุชูุงููุงุช</button>
            <button onclick="runSystemTest()" class="btn">ุงุฎุชุจุงุฑ ุงููุธุงู</button>
          </div>
          <div class="admin-section">
            <h4>ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</h4>
            <button onclick="exportData()" class="btn">ุชุตุฏูุฑ ุงูุจูุงูุงุช</button>
            <button onclick="importData()" class="btn">ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช</button>
            <button onclick="resetSystem()" class="btn danger">ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู</button>
          </div>
        </div>
      </div>
    </main>
  `;
  
  loadAgents();
  loadFlows();
}

// Tab switching
function showTab(tabName) {
  // Hide all tabs
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Show selected tab
  const selectedTab = document.getElementById(tabName);
  if (selectedTab) {
    selectedTab.classList.add('active');
  }
  
  // Activate button
  event.target.classList.add('active');
}

// Command execution
async function executeCommand(command) {
  showMessage(`ุชูููุฐ ุงูุฃูุฑ: ${command}`, "info");
  
  // Mock command execution - will be replaced with actual SuperAI integration
  setTimeout(() => {
    if (command.includes('/turbo on')) {
      document.getElementById('turboStatus').textContent = 'ูุดุท';
      showMessage("๐ ุชู ุชูุนูู ุงูุชุณุงุฑุน ุจูุฌุงุญ!", "success");
    } else if (command.includes('/connect all')) {
      showMessage("โ ุชู ุฑุจุท ุฌููุน ุงูููุตุงุช ุงูุนุงูููุฉ ุจูุฌุงุญ!", "success");
    } else if (command.includes('/run')) {
      showMessage("๐ค ุชู ุชุดุบูู ุงููููู ุจูุฌุงุญ!", "success");
    }
  }, 1000);
}

// Chat functions
function sendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  if (!message) return;
  
  addChatMessage(message, 'user');
  input.value = '';
  
  // Mock AI response
  setTimeout(() => {
    const responses = [
      "ูุฑุญุจุงู! ููู ูููููู ูุณุงุนุฏุชู ุงููููุ",
      "ุชู ููู ุทูุจูุ ุฌุงุฑู ุงูุชูููุฐ...",
      "ูู ุชุฑูุฏ ููู ุฑุจุท ููุตุฉ ูุนููุฉุ",
      "ูููููู ูุณุงุนุฏุชู ูู ุฅุฏุงุฑุฉ ุงููููุงุก ูุงูุชุฏููุงุช"
    ];
    const response = responses[Math.floor(Math.random() * responses.length)];
    addChatMessage(response, 'ai');
  }, 1000);
}

function addChatMessage(message, sender) {
  const messagesDiv = document.getElementById('chatMessages');
  const messageDiv = document.createElement('div');
  messageDiv.className = `chat-message ${sender}`;
  messageDiv.innerHTML = `
    <div class="message-content">${message}</div>
    <div class="message-time">${new Date().toLocaleTimeString('ar-EG')}</div>
  `;
  messagesDiv.appendChild(messageDiv);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function startVoiceInput() {
  if ('webkitSpeechRecognition' in window) {
    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'ar-EG';
    recognition.onresult = function(event) {
      const transcript = event.results[0][0].transcript;
      document.getElementById('chatInput').value = transcript;
    };
    recognition.start();
    showMessage("๐ค ูุชู ุงูุงุณุชูุงุน...", "info");
  } else {
    showMessage("โ ุงููุชุตูุญ ูุง ูุฏุนู ุงูุชุนุฑู ุนูู ุงูุตูุช", "error");
  }
}

// Agent management
async function loadAgents() {
  const agentsList = document.getElementById('agentsList');
  if (!agentsList) return;
  
  // Mock agents data - will be replaced with actual API call
  const agents = [
    { id: 1, name: "ูููู ุงูุฐูุงุก ุงูุชุฌุงุฑู", role: "commerce", status: "active" },
    { id: 2, name: "ูููู ุฎุฏูุฉ ุงูุนููุงุก", role: "support", status: "idle" },
    { id: 3, name: "ูููู ุงูุชุญูููุงุช", role: "analytics", status: "active" }
  ];
  
  agentsList.innerHTML = agents.map(agent => `
    <div class="agent-item">
      <div class="agent-info">
        <h4>${agent.name}</h4>
        <p>ุงูููุน: ${agent.role} | ุงูุญุงูุฉ: ${agent.status}</p>
      </div>
      <div class="agent-actions">
        <button onclick="runAgent(${agent.id})" class="btn">ุชุดุบูู</button>
        <button onclick="editAgent(${agent.id})" class="btn">ุชุนุฏูู</button>
        <button onclick="deleteAgent(${agent.id})" class="btn danger">ุญุฐู</button>
      </div>
    </div>
  `).join('');
}

function addNewAgent() {
  const name = prompt("ุงุณู ุงููููู ุงูุฌุฏูุฏ:");
  const role = prompt("ููุน ุงููููู (commerce, support, analytics):");
  
  if (name && role) {
    showMessage(`โ ุชู ุฅุถุงูุฉ ุงููููู "${name}" ุจูุฌุงุญ!`, "success");
    loadAgents();
  }
}

function runAgent(id) {
  showMessage(`๐ค ุชู ุชุดุบูู ุงููููู #${id}`, "success");
}

function editAgent(id) {
  showMessage(`โ๏ธ ุชุญุฑูุฑ ุงููููู #${id}`, "info");
}

function deleteAgent(id) {
  if (confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูููููุ")) {
    showMessage(`๐๏ธ ุชู ุญุฐู ุงููููู #${id}`, "success");
    loadAgents();
  }
}

// Flow management
async function loadFlows() {
  const flowsList = document.getElementById('flowsList');
  if (!flowsList) return;
  
  // Mock flows data
  const flows = [
    { id: "flow_1", name: "ุชุฏูู ุฅุฏุงุฑุฉ ุงูุทูุจุงุช", trigger: "manual", status: "active" },
    { id: "flow_2", name: "ุชุฏูู ุชุณูููู ุชููุงุฆู", trigger: "webhook", status: "idle" },
    { id: "flow_3", name: "ุชุฏูู ุชุญููู ุงูุจูุงูุงุช", trigger: "schedule", status: "active" }
  ];
  
  flowsList.innerHTML = flows.map(flow => `
    <div class="flow-item">
      <div class="flow-info">
        <h4>${flow.name}</h4>
        <p>ุงููุดุบู: ${flow.trigger} | ุงูุญุงูุฉ: ${flow.status}</p>
      </div>
      <div class="flow-actions">
        <button onclick="runFlow('${flow.id}')" class="btn">ุชุดุบูู</button>
        <button onclick="editFlow('${flow.id}')" class="btn">ุชุนุฏูู</button>
        <button onclick="deleteFlow('${flow.id}')" class="btn danger">ุญุฐู</button>
      </div>
    </div>
  `).join('');
}

function addNewFlow() {
  const name = prompt("ุงุณู ุงูุชุฏูู ุงูุฌุฏูุฏ:");
  const trigger = prompt("ููุน ุงููุดุบู (manual, webhook, schedule):");
  
  if (name && trigger) {
    showMessage(`โ ุชู ุฅุถุงูุฉ ุงูุชุฏูู "${name}" ุจูุฌุงุญ!`, "success");
    loadFlows();
  }
}

function runFlow(id) {
  showMessage(`โก ุชู ุชุดุบูู ุงูุชุฏูู ${id}`, "success");
}

function editFlow(id) {
  showMessage(`โ๏ธ ุชุญุฑูุฑ ุงูุชุฏูู ${id}`, "info");
}

function deleteFlow(id) {
  if (confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุชุฏููุ")) {
    showMessage(`๐๏ธ ุชู ุญุฐู ุงูุชุฏูู ${id}`, "success");
    loadFlows();
  }
}

// Platform connections
function connectPlatform(platform) {
  showMessage(`๐ ุฌุงุฑู ุฑุจุท ููุตุฉ ${platform}...`, "info");
  
  setTimeout(() => {
    showMessage(`โ ุชู ุฑุจุท ููุตุฉ ${platform} ุจูุฌุงุญ!`, "success");
  }, 2000);
}

// Admin functions
function toggleTurbo() {
  const status = document.getElementById('turboStatus');
  if (status.textContent === 'ูุดุท') {
    status.textContent = 'ูุชููู';
    showMessage("๐ข ุชู ุฅููุงู ุงูุชุณุงุฑุน", "info");
  } else {
    status.textContent = 'ูุดุท';
    showMessage("๐ ุชู ุชูุนูู ุงูุชุณุงุฑุน", "success");
  }
}

function syncIntegrations() {
  showMessage("๐ ุฌุงุฑู ูุฒุงููุฉ ุงูุชูุงููุงุช...", "info");
  setTimeout(() => {
    showMessage("โ ุชู ูุฒุงููุฉ ุฌููุน ุงูุชูุงููุงุช ุจูุฌุงุญ!", "success");
  }, 3000);
}

function runSystemTest() {
  showMessage("๐งช ุฌุงุฑู ุงุฎุชุจุงุฑ ุงููุธุงู...", "info");
  setTimeout(() => {
    showMessage("โ ุชู ุงุฎุชุจุงุฑ ุงููุธุงู ุจูุฌุงุญ - ุฌููุน ุงูุฃูุธูุฉ ุชุนูู ุจููุงุกุฉ 100%!", "success");
  }, 5000);
}

function exportData() {
  showMessage("๐ค ุฌุงุฑู ุชุตุฏูุฑ ุงูุจูุงูุงุช...", "info");
  setTimeout(() => {
    showMessage("โ ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ุจูุฌุงุญ!", "success");
  }, 2000);
}

function importData() {
  showMessage("๐ฅ ุฌุงุฑู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช...", "info");
  setTimeout(() => {
    showMessage("โ ุชู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ุจูุฌุงุญ!", "success");
  }, 2000);
}

function resetSystem() {
  if (confirm("ุชุญุฐูุฑ: ูุฐุง ุณูุคุฏู ุฅูู ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงูุจูุงูุงุช. ูู ุฃูุช ูุชุฃูุฏุ")) {
    showMessage("๐ ุฌุงุฑู ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู...", "info");
    setTimeout(() => {
      showMessage("โ ุชู ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู ุจูุฌุงุญ!", "success");
    }, 3000);
  }
}

// Make functions global
window.login = login;
window.signup = signup;
window.logout = logout;
window.showSignupForm = showSignupForm;
window.showTab = showTab;
window.executeCommand = executeCommand;
window.sendMessage = sendMessage;
window.startVoiceInput = startVoiceInput;
window.loadAgents = loadAgents;
window.addNewAgent = addNewAgent;
window.runAgent = runAgent;
window.editAgent = editAgent;
window.deleteAgent = deleteAgent;
window.loadFlows = loadFlows;
window.addNewFlow = addNewFlow;
window.runFlow = runFlow;
window.editFlow = editFlow;
window.deleteFlow = deleteFlow;
window.connectPlatform = connectPlatform;
window.toggleTurbo = toggleTurbo;
window.syncIntegrations = syncIntegrations;
window.runSystemTest = runSystemTest;
window.exportData = exportData;
window.importData = importData;
window.resetSystem = resetSystem;

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
  showLoginForm();
});
